<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hexo</title>
  <style>
  	body *{
  		padding: 0px;
  		margin: 0px;
  		font-size: 14px;
  	}
  	body * {
  		border-bottom: 1px red solid;
  	}
  	.title {
  		font-weight: bold;
  		background: #acc;
  		padding-left: 10px
  	}
  	.title2 {
  		background: #ddd;
  		list-style: none;
  		padding-left: 60px
  	}
  	li{
  		padding: 3px 0 3px 110px;
  	}
	.hidden {
		display:none;
	}
  </style>
  <script src="//cdn.bootcss.com/jquery/1.12.1/jquery.js"></script>
</head>
<body>
	<div id=a></div>
	<script>
	
		var html = [
			'<ul>',
				"<each departList='a'>",
					'<li class="title">{a.departName} 一级</li>',
					"<each a.group='b'>",
						'<li class="title2">{b.groupName} 二级</li>',
						"<each b.userList='c'>",
							'<li>{c.name}  三级</li>',
							"<each c.list='d'>",
								'<li style="padding-left: 160px">{d.name} 四级</li>',
								"<each d.list='e'>",
									'<li style="padding-left: 200px">{e.name} 五级</li>',
									"<each e.list='f'>",
										'<li style="padding-left: 260px">{f.name} 六级</li>',
										"<each f.list='g'>",
											'<li style="padding-left: 300px">{g.name} 七级</li>',
											"<each g.list='h'>",
												'<li style="padding-left: 360px">{h.name} 八级</li>',
												"<each h.list='ii'>",
													'<li style="padding-left: 400px">{ii.name} 九级</li>',
												'</each>',
											'</each>',
										'</each>',
									'</each>',
								'</each>',
							'</each>',
						'</each>',
					'</each>',
				'</each>',
			'</ul>',
		].join('');
		
		$.get('getData', function(data) {
			var start = new Date().getTime();
			
			for(var i = 0; i < 100; i ++) {
				var h = bonTemplate(html, data);
			}
			a.innerHTML = h;
			var time = (new Date().getTime() - start);
			alert(time);
		});
		
		
		function bonTemplate(html, data) {
			
			var htmlTags = html.split(/<\/?each\s?[^>]*>/);
			var eachTags = html.match(/<\/?each\s?[^>]*>/g);
			
			var tpl = [], complierTpl = [];
			var biggerLength = Math.max(htmlTags.length, eachTags.length);
			for(var i = 0; i < biggerLength; i ++) {
			
				var hTag = (htmlTags[i]).replace(/"/g, '\\\"').replace(/{([^}]+)}/g, function(x, key) {
					return '" + (' + key + ') + "';
				});
				var eTag = eachTags[i];
				
				var h = e = '';
				if(hTag) {
					h = 'complierTpl.push( "' + hTag + '"); \n';
					tpl.push(h);
				}
				if(eTag) {
					var matchs = /<each\s+([\w.]+)\=['"]?(\w+)['"]?\s*>/.exec(eTag);
					e = matchs ? matchs[1] + '.forEach(function(' + matchs[2] + ', i) { \n' : '}); \n';
					matchs = null;
					tpl.push(e);
				}
			}
			
			eval('with(data) { ' + tpl.join('') + '}');
			
			var result = complierTpl.join('');
			tpl = html = complierTpl = eachTags = htmlTags = null;
			return result;
		}
	
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	</script>
</body>
</html>